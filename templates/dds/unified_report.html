{% extends "base.html" %}
{% block title %}Единый отчёт — Акча-Hotel{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-0">Единый отчёт по сети</h1>
    <div class="text-muted small">Приход / Расход / Остаток по всем отелям</div>
  </div>
  <div class="col-md-4 d-grid">
  <a class="btn btn-outline-success"
     href="{% url 'dds:unified_report_excel' %}?date_from={{ date_from|date:'Y-m-d' }}&date_to={{ date_to|date:'Y-m-d' }}">
    Excel
  </a>
</div>

  <a class="btn btn-outline-secondary" href="{% url 'dds:dds_dashboard' %}">← Назад</a>
</div>

<form class="row g-2 mb-3">
  <div class="col-md-4">
    <input type="date" class="form-control" name="date_from" value="{{ date_from|date:'Y-m-d' }}">
  </div>
  <div class="col-md-4">
    <input type="date" class="form-control" name="date_to" value="{{ date_to|date:'Y-m-d' }}">
  </div>
  <div class="col-md-4 d-grid">
    <button class="btn btn-dark">Показать</button>
  </div>
</form>

<div class="row g-2 mb-3">
  <div class="col-md-4"><div class="card app-card"><div class="card-body">Итого приход: <b>{{ total_income }}</b></div></div></div>
  <div class="col-md-4"><div class="card app-card"><div class="card-body">Итого расход: <b>{{ total_expense }}</b></div></div></div>
  <div class="col-md-4"><div class="card app-card"><div class="card-body">Итого остаток: <b>{{ total_balance }}</b></div></div></div>
</div>

<div class="card app-card mb-3">
  <div class="card-body">
    <h2 class="h6 mb-2">Свод по отелям</h2>
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>Отель</th>
            <th class="text-end">Приход</th>
            <th class="text-end">Расход</th>
            <th class="text-end">Остаток</th>
          </tr>
        </thead>
        <tbody>
          {% for r in by_hotels %}
          <tr>
            <td><b>{{ r.hotel__name }}</b></td>
            <td class="text-end">{{ r.income }}</td>
            <td class="text-end">{{ r.expense }}</td>
            <td class="text-end"><b>{{ r.balance }}</b></td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-muted">Нет данных за выбранный период</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card app-card">
  <div class="card-body">
    <h2 class="h6 mb-2">Свод по статьям (по сети)</h2>
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>Тип</th>
            <th>Статья</th>
            <th class="text-end">Сумма</th>
          </tr>
        </thead>
        <tbody>
          {% for r in by_articles %}
          <tr>
            <td>
              <span class="badge {% if r.article__kind == 'income' %}bg-success{% else %}bg-danger{% endif %}">
                {{ r.article__kind }}
              </span>
            </td>
            <td>{{ r.article__name }}</td>
            <td class="text-end"><b>{{ r.total }}</b></td>
          </tr>
          {% empty %}
          <tr><td colspan="3" class="text-muted">Нет данных</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
